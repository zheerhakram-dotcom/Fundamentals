<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal Dashboard</title>
    <style>
        * { box-sizing: border-box; }
        body { margin:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#0d1117; color:#e6eef6; }
        header { background:#161b22; padding:20px; border-bottom:1px solid #30363d; }
        header h1 { margin:0; font-size:1.5rem; color:#fff; }
        nav { margin-top:10px; display:flex; gap:10px; flex-wrap: wrap; }
        nav a { padding:8px 14px; border-radius:8px; text-decoration:none; color:#c9d1d9; background:#21262d; transition:0.2s; white-space: nowrap; }
        nav a.active, nav a:hover { background:#58a6ff; color:#fff; }
        main { padding:20px; }
        .grid-2x2 { display:grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap:20px; }
        .card { background:#161b22; border:1px solid #30363d; border-radius:12px; padding:16px; box-shadow:0 2px 6px rgba(0,0,0,0.3); }
        .card h2 { margin-top:0; font-size:1.1rem; border-bottom:1px solid #30363d; padding-bottom:6px; }
        textarea { background:#0d1117; color:#e6eef6; border:1px solid #30363d; border-radius:6px; padding:8px; width:100%; resize:vertical; }
        button { margin-top:8px; padding:8px 14px; border:none; border-radius:6px; background:#58a6ff; color:#fff; cursor:pointer; transition:0.2s; }
        button:hover { background:#1f6feb; }
        #journal-list div { background:#21262d; padding:6px 8px; margin-top:6px; border-radius:6px; }
        ul.feed { list-style:none; padding:0; }
        ul.feed li { margin:8px 0; padding:8px; background:#21262d; border-radius:6px; }
        ul.feed li a { color:#58a6ff; text-decoration:none; }
        ul.feed li a:hover { text-decoration:underline; }
        .small { font-size:13px; color:#9aa4b2; }
        .row { display:flex; gap:8px; align-items:center; }
        .analytics { display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin-top:12px; }
        canvas { background:transparent; }
        .import-area { display:flex; gap:8px; align-items:center; }
        input[type=file] { color: #000; }
        .metric { background:#0b1220; padding:10px; border-radius:8px; text-align:center; }
        .metric h3 { margin:0; font-size:18px; }
        .metric p { margin:4px 0 0; color:#9aa4b2; }
        
        /* Economic Calendar Styles */
        .calendar-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .calendar-controls h3 { margin: 0; }
        .calendar-filters { display: flex; gap: 10px; align-items: center; }
        .calendar-filters select { background: #0d1117; color: #e6eef6; border: 1px solid #30363d; border-radius: 4px; padding: 5px; }
        .calendar-event { display: grid; grid-template-columns: 100px 80px 1fr 80px; gap: 10px; padding: 12px; border-bottom: 1px solid #30363d; align-items: center; }
        .calendar-event:last-child { border-bottom: none; }
        .event-date { font-size: 13px; color: #9aa4b2; font-weight: 500; }
        .event-time { font-size: 13px; color: #9aa4b2; }
        .event-details { display: flex; flex-direction: column; }
        .event-title { font-weight: 500; margin-bottom: 4px; }
        .event-country { font-size: 12px; color: #9aa4b2; }
        .event-importance { display: flex; justify-content: center; }
        .importance-high, .importance-medium, .importance-low { padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
        .importance-high { background: #f85149; color: #fff; }
        .importance-medium { background: #d29922; color: #fff; }
        .importance-low { background: #3fb950; color: #fff; }
        .calendar-loading { text-align: center; padding: 20px; color: #9aa4b2; }
        .calendar-error { text-align: center; padding: 20px; color: #f85149; }
        .calendar-date-header { background: #21262d; padding: 8px 12px; margin-top: 15px; border-radius: 6px; font-weight: 500; }
        .calendar-date-header:first-child { margin-top: 0; }
        
        /* News Tab Styles */
        .news-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .news-controls h3 { margin: 0; }
        .news-source-filter { display: flex; gap: 10px; align-items: center; }
        .news-source-filter select { background: #0d1117; color: #e6eef6; border: 1px solid #30363d; border-radius: 4px; padding: 5px; }
        .news-item { margin: 12px 0; padding: 12px; background: #21262d; border-radius: 6px; border-left: 3px solid #58a6ff; }
        .news-item-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .news-source { font-size: 12px; color: #58a6ff; font-weight: 500; }
        .news-time { font-size: 12px; color: #9aa4b2; }
        .news-title { font-weight: 500; margin-bottom: 4px; }
        .news-description { font-size: 13px; color: #9aa4b2; margin-bottom: 8px; }
        .news-link { color: #58a6ff; text-decoration: none; font-size: 13px; }
        .news-link:hover { text-decoration: underline; }
        .news-loading { text-align: center; padding: 20px; color: #9aa4b2; }
        .news-error { text-align: center; padding: 20px; color: #f85149; }
        .last-updated { text-align: right; font-size: 12px; color: #9aa4b2; margin-top: 10px; }
        
        /* RSS Import Styles */
        .rss-import { background: #21262d; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .rss-input-group { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .rss-input-group input { flex: 1; background: #0d1117; color: #e6eef6; border: 1px solid #30363d; border-radius: 4px; padding: 8px; }
        .rss-input-group.file-input { flex-wrap: wrap; }
        .rss-input-group.file-input input[type="file"] { flex: 1; }
        .rss-feeds-list { margin-top: 15px; }
        .rss-feed-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #161b22; border-radius: 4px; margin-bottom: 5px; }
        .rss-feed-name { font-size: 14px; }
        .rss-feed-type { font-size: 12px; color: #9aa4b2; margin-left: 8px; }
        .rss-feed-actions { display: flex; gap: 5px; }
        .rss-feed-actions button { margin: 0; padding: 4px 8px; font-size: 12px; }
        .tab-buttons { display: flex; margin-bottom: 15px; border-bottom: 1px solid #30363d; }
        .tab-button { padding: 8px 16px; background: none; border: none; color: #c9d1d9; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab-button.active { color: #58a6ff; border-bottom-color: #58a6ff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Ticker Tape Styles */
        .ticker-container { background: #0d1117; padding: 10px; border-radius: 6px; margin-bottom: 15px; overflow: hidden; }
        .ticker-tape-widget { height: 46px; }
        
        /* Market Analysis Styles */
        .market-overview { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .sentiment-indicator { background: #21262d; padding: 15px; border-radius: 8px; text-align: center; }
        .sentiment-value { font-size: 24px; font-weight: bold; margin: 10px 0; }
        .sentiment-bullish { color: #3fb950; }
        .sentiment-bearish { color: #f85149; }
        .sentiment-neutral { color: #d29922; }
        .indicator-controls { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .indicator-controls select, .indicator-controls input { background: #0d1117; color: #e6eef6; border: 1px solid #30363d; border-radius: 4px; padding: 5px; }
        .technical-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .indicator-card { background: #161b22; border-radius: 8px; padding: 15px; }
        .indicator-card h3 { margin-top: 0; font-size: 1rem; border-bottom: 1px solid #30363d; padding-bottom: 8px; }
        .indicator-value { font-size: 18px; font-weight: bold; margin: 10px 0; text-align: center; }
        .indicator-details { font-size: 13px; color: #9aa4b2; }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .grid-2x2 { grid-template-columns: 1fr; }
            .technical-grid { grid-template-columns: 1fr; }
            .market-overview { grid-template-columns: 1fr 1fr; }
            nav { flex-wrap: wrap; }
            nav a { font-size: 0.9rem; padding: 6px 10px; }
        }
    </style>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>Trading Journal & Market Dashboard</h1>
        <nav>
            <a href="#dashboard" class="active" onclick="showTab('dashboard', this)">ðŸ“Š Dashboard</a>
            <a href="#ticker" onclick="showTab('ticker', this)">ðŸ“ˆ Live Ticker</a>
            <a href="#analysis" onclick="showTab('analysis', this)">ðŸ“‰ Market Analysis</a>
            <a href="#journal" onclick="showTab('journal', this)">ðŸ““ Journal</a>
            <a href="#news" onclick="showTab('news', this)">ðŸ“° News</a>
            <a href="#calendar" onclick="showTab('calendar', this)">ðŸ“… Economic Calendar</a>
        </nav>
    </header>

    <main>
        <section id="dashboard" class="tab">
            <!-- Ticker Tape at the top of Dashboard -->
            <div class="ticker-container">
                <div class="tradingview-widget-container">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
                    {
                    "symbols": [
                        {
                        "proName": "FOREXCOM:SPXUSD",
                        "title": "S&P 500"
                        },
                        {
                        "proName": "FOREXCOM:NSXUSD",
                        "title": "US 100"
                        },
                        {
                        "proName": "FX_IDC:EURUSD",
                        "title": "EUR/USD"
                        },
                        {
                        "proName": "BITSTAMP:BTCUSD",
                        "title": "Bitcoin"
                        },
                        {
                        "proName": "BITSTAMP:ETHUSD",
                        "title": "Ethereum"
                        },
                        {
                        "description": "Gold",
                        "proName": "OANDA:XAUUSD"
                        },
                        {
                        "description": "Silver",
                        "proName": "OANDA:XAGUSD"
                        },
                        {
                        "description": "Oil",
                        "proName": "TVC:USOIL"
                        }
                    ],
                    "showSymbolLogo": true,
                    "colorTheme": "dark",
                    "isTransparent": false,
                    "displayMode": "adaptive",
                    "locale": "en"
                    }
                    </script>
                </div>
            </div>
            
            <div class="grid-2x2">
                <div class="card">
                    <h2>EUR/USD</h2>
                    <div class="tradingview-widget-container">
                        <div id="chart_eurusd"></div>
                        <script type="text/javascript">
                            new TradingView.widget({
                                "width": "100%",
                                "height": 300,
                                "symbol": "FX:EURUSD",
                                "interval": "60",
                                "timezone": "Etc/UTC",
                                "theme": "dark",
                                "style": "1",
                                "locale": "en",
                                "enable_publishing": false,
                                "allow_symbol_change": true,
                                "container_id": "chart_eurusd"
                            });
                        </script>
                    </div>
                </div>
                <div class="card">
                    <h2>XAU/USD (Gold)</h2>
                    <div class="tradingview-widget-container">
                        <div id="chart_xauusd"></div>
                        <script type="text/javascript">
                            new TradingView.widget({
                                "width": "100%",
                                "height": 300,
                                "symbol": "OANDA:XAUUSD",
                                "interval": "60",
                                "timezone": "Etc/UTC",
                                "theme": "dark",
                                "style": "1",
                                "locale": "en",
                                "enable_publishing": false,
                                "allow_symbol_change": true,
                                "container_id": "chart_xauusd"
                            });
                        </script>
                    </div>
                </div>
                <div class="card">
                    <h2>USD/JPY</h2>
                    <div class="tradingview-widget-container">
                        <div id="chart_usdjpy"></div>
                        <script type="text/javascript">
                            new TradingView.widget({
                                "width": "100%",
                                "height": 300,
                                "symbol": "FX:USDJPY",
                                "interval": "60",
                                "timezone": "Etc/UTC",
                                "theme": "dark",
                                "style": "1",
                                "locale": "en",
                                "enable_publishing": false,
                                "allow_symbol_change": true,
                                "container_id": "chart_usdjpy"
                            });
                        </script>
                    </div>
                </div>
                <div class="card">
                    <h2>Crude Oil (WTI)</h2>
                    <div class="tradingview-widget-container">
                        <div id="chart_wti"></div>
                        <script type="text/javascript">
                            new TradingView.widget({
                                "width": "100%",
                                "height": 300,
                                "symbol": "TVC:USOIL",
                                "interval": "60",
                                "timezone": "Etc/UTC",
                                "theme": "dark",
                                "style": "1",
                                "locale": "en",
                                "enable_publishing": false,
                                "allow_symbol_change": true,
                                "container_id": "chart_wti"
                            });
                        </script>
                    </div>
                </div>
            </div>
        </section>

        <section id="ticker" class="tab" style="display:none">
            <div class="card">
                <h2>Live Forex & Commodities Ticker</h2>
                <div class="ticker-container">
                    <div class="tradingview-widget-container">
                        <div class="tradingview-widget-container__widget"></div>
                        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
                        {
                        "symbols": [
                            {
                            "proName": "FX_IDC:EURUSD",
                            "title": "EUR/USD"
                            },
                            {
                            "proName": "FX_IDC:GBPUSD",
                            "title": "GBP/USD"
                            },
                            {
                            "proName": "FX_IDC:USDJPY",
                            "title": "USD/JPY"
                            },
                            {
                            "proName": "FX_IDC:USDCHF",
                            "title": "USD/CHF"
                            },
                            {
                            "proName": "FX_IDC:AUDUSD",
                            "title": "AUD/USD"
                            },
                            {
                            "proName": "FX_IDC:USDCAD",
                            "title": "USD/CAD"
                            },
                            {
                            "proName": "FX_IDC:NZDUSD",
                            "title": "NZD/USD"
                            },
                            {
                            "description": "Gold",
                            "proName": "OANDA:XAUUSD"
                            },
                            {
                            "description": "Silver",
                            "proName": "OANDA:XAGUSD"
                            },
                            {
                            "description": "Oil",
                            "proName": "TVC:USOIL"
                            },
                            {
                            "description": "Natural Gas",
                            "proName": "TVC:NGAS"
                            },
                            {
                            "proName": "BITSTAMP:BTCUSD",
                            "title": "Bitcoin"
                            },
                            {
                            "proName": "BITSTAMP:ETHUSD",
                            "title": "Ethereum"
                            }
                        ],
                        "showSymbolLogo": true,
                        "colorTheme": "dark",
                        "isTransparent": false,
                        "displayMode": "adaptive",
                        "locale": "en"
                        }
                        </script>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>Major Forex Pairs</h3>
                    <div class="grid-2x2">
                        <div class="card">
                            <h4>EUR/USD</h4>
                            <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
                                {
                                "symbol": "FX:EURUSD",
                                "width": "100%",
                                "colorTheme": "dark",
                                "isTransparent": false,
                                "locale": "en"
                                }
                                </script>
                            </div>
                        </div>
                        <div class="card">
                            <h4>GBP/USD</h4>
                            <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
                                {
                                "symbol": "FX:GBPUSD",
                                "width": "100%",
                                "colorTheme": "dark",
                                "isTransparent": false,
                                "locale": "en"
                                }
                                </script>
                            </div>
                        </div>
                        <div class="card">
                            <h4>USD/JPY</h4>
                            <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
                                {
                                "symbol": "FX:USDJPY",
                                "width": "100%",
                                "colorTheme": "dark",
                                "isTransparent": false,
                                "locale": "en"
                                }
                                </script>
                            </div>
                        </div>
                        <div class="card">
                            <h4>USD/CHF</h4>
                            <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
                                {
                                "symbol": "FX:USDCHF",
                                "width": "100%",
                                "colorTheme": "dark",
                                "isTransparent": false,
                                "locale": "en"
                                }
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>Commodities</h3>
                    <div class="grid-2x2">
                        <div class="card">
                            <h4>Gold (XAU/USD)</h4>
                            <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
                                {
                                "symbol": "OANDA:XAUUSD",
                                "width": "100%",
                                "colorTheme": "dark",
                                "isTransparent": false,
                                "locale": "en"
                                }
                                </script>
                            </div>
                        </div>
                        <div class="card">
                            <h4>Silver (XAG/USD)</h4>
                            <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
                                {
                                "symbol": "OANDA:XAGUSD",
                                "width": "100%",
                                "colorTheme": "dark",
                                "isTransparent": false,
                                "locale": "en"
                                }
                                </script>
                            </div>
                        </div>
                        <div class="card">
                            <h4>Crude Oil (WTI)</h4>
                            <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
                                {
                                "symbol": "TVC:USOIL",
                                "width": "100%",
                                "colorTheme": "dark",
                                "isTransparent": false,
                                "locale": "en"
                                }
                                </script>
                            </div>
                        </div>
                        <div class="card">
                            <h4>Natural Gas</h4>
                            <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
                                {
                                "symbol": "TVC:NGAS",
                                "width": "100%",
                                "colorTheme": "dark",
                                "isTransparent": false,
                                "locale": "en"
                                }
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="analysis" class="tab" style="display:none">
            <div class="card">
                <h2>Market Analysis & Sentiment</h2>
                
                <div class="market-overview">
                    <div class="sentiment-indicator">
                        <h3>Overall Market Sentiment</h3>
                        <div class="sentiment-value sentiment-bullish" id="overall-sentiment">Loading...</div>
                        <div class="small">Based on technical indicators across major pairs</div>
                    </div>
                    <div class="sentiment-indicator">
                        <h3>Forex Sentiment</h3>
                        <div class="sentiment-value sentiment-neutral" id="forex-sentiment">Loading...</div>
                        <div class="small">Major currency pairs analysis</div>
                    </div>
                    <div class="sentiment-indicator">
                        <h3>Commodities Sentiment</h3>
                        <div class="sentiment-value sentiment-bullish" id="commodities-sentiment">Loading...</div>
                        <div class="small">Gold, Oil, Silver, etc.</div>
                    </div>
                    <div class="sentiment-indicator">
                        <h3>Market Volatility</h3>
                        <div class="sentiment-value sentiment-bearish" id="volatility">Loading...</div>
                        <div class="small">Current market conditions</div>
                    </div>
                </div>
                
                <div class="indicator-controls">
                    <select id="analysis-symbol">
                        <option value="EURUSD">EUR/USD</option>
                        <option value="GBPUSD">GBP/USD</option>
                        <option value="USDJPY">USD/JPY</option>
                        <option value="XAUUSD">Gold (XAU/USD)</option>
                        <option value="USOIL">Crude Oil (WTI)</option>
                    </select>
                    <select id="analysis-timeframe">
                        <option value="15">15 Minutes</option>
                        <option value="60" selected>1 Hour</option>
                        <option value="240">4 Hours</option>
                        <option value="D">Daily</option>
                    </select>
                    <button id="refresh-analysis">Refresh Analysis</button>
                </div>
                
                <!-- TradingView Technical Analysis Widget -->
                <div class="tradingview-widget-container">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js" async>
                    {
                    "interval": "1h",
                    "width": "100%",
                    "isTransparent": false,
                    "height": 450,
                    "symbol": "FX:EURUSD",
                    "showIntervalTabs": true,
                    "displayMode": "single",
                    "locale": "en",
                    "colorTheme": "dark"
                    }
                    </script>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>Advanced Chart with Indicators</h3>
                    <div class="tradingview-widget-container">
                        <div id="advanced-chart"></div>
                        <script type="text/javascript">
                            new TradingView.widget({
                                "width": "100%",
                                "height": 500,
                                "symbol": "FX:EURUSD",
                                "interval": "60",
                                "timezone": "Etc/UTC",
                                "theme": "dark",
                                "style": "1",
                                "locale": "en",
                                "enable_publishing": false,
                                "allow_symbol_change": true,
                                "container_id": "advanced-chart",
                                "studies": [
                                    "RSI@tv-basicstudies",
                                    "MACD@tv-basicstudies",
                                    "StochasticRSI@tv-basicstudies",
                                    "Volume@tv-basicstudies"
                                ]
                            });
                        </script>
                    </div>
                </div>
            </div>
        </section>

        <section id="journal" class="tab" style="display:none">
            <div class="card">
                <h2>Trading Journal & Analytics</h2>
                <div class="small">Import your trade history (HTML or CSV) and it will automatically analyze your trades and chart performance.</div>
                <div style="margin-top:12px" class="import-area">
                    <input type="file" id="file-input" accept=".html,.htm,.csv,.txt" />
                    <button id="btn-import">Import File</button>
                    <button id="btn-clear-analytics">Clear Analysis</button>
                </div>
                <div style="margin-top:12px">
                    <label class="small">Or paste CSV / table text below and press Parse:</label>
                    <textarea id="paste-area" rows="6" placeholder="date,symbol,side,entry,exit,size,profit"></textarea>
                    <div class="row" style="margin-top:8px"><button id="btn-parse">Parse & Analyze</button><div class="small">(supports flexible column names: date, time, symbol, side, entry, exit, qty, size, pnl, profit)</div></div>
                </div>

                <div id="analytics-output" style="margin-top:14px;">
                    <div class="row" id="metrics-row" style="gap:12px"></div>

                    <div class="analytics">
                        <div class="card">
                            <h3>Equity Curve</h3>
                            <canvas id="chart-equity" width="400" height="250"></canvas>
                        </div>
                        <div class="card">
                            <h3>P/L Distribution</h3>
                            <canvas id="chart-hist" width="400" height="250"></canvas>
                        </div>
                        <div class="card">
                            <h3>Win/Loss</h3>
                            <canvas id="chart-winloss" width="400" height="250"></canvas>
                        </div>
                        <div class="card">
                            <h3>P/L by Symbol</h3>
                            <canvas id="chart-symbols" width="400" height="250"></canvas>
                        </div>
                    </div>

                    <div style="margin-top:12px" class="card">
                        <h3>Parsed Trades (first 200)</h3>
                        <div id="parsed-trades" style="max-height:260px;overflow:auto"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="news" class="tab" style="display:none">
            <div class="card">
                <h2>Live Financial News</h2>
                
                <!-- RSS Feed Import Section -->
                <div class="rss-import">
                    <h3>Import Custom RSS Feeds</h3>
                    
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="showRssTab('url-tab', this)">Add by URL</button>
                        <button class="tab-button" onclick="showRssTab('file-tab', this)">Upload XML File</button>
                    </div>
                    
                    <!-- URL Tab -->
                    <div id="url-tab" class="tab-content active">
                        <div class="rss-input-group">
                            <input type="text" id="rss-url" placeholder="Enter RSS feed URL (e.g., https://example.com/feed.xml)" />
                            <input type="text" id="rss-name" placeholder="Feed name (optional)" />
                            <button id="add-rss-feed">Add Feed</button>
                        </div>
                        <div class="small">Enter the direct URL of an RSS feed. This will automatically update with new content.</div>
                    </div>
                    
                    <!-- File Upload Tab -->
                    <div id="file-tab" class="tab-content">
                        <div class="rss-input-group file-input">
                            <input type="file" id="rss-file" accept=".xml,.rss" />
                            <input type="text" id="rss-file-name" placeholder="Feed name (optional)" />
                            <button id="add-rss-file">Upload Feed</button>
                        </div>
                        <div class="small">Upload an XML/RSS file you've downloaded. Note: This won't auto-update with new content.</div>
                    </div>
                    
                    <div class="rss-feeds-list" id="rss-feeds-list">
                        <!-- Custom RSS feeds will be listed here -->
                    </div>
                </div>

                <div class="news-controls">
                    <h3>Latest Updates</h3>
                    <div class="news-source-filter">
                        <select id="news-source-filter">
                            <option value="all">All Sources</option>
                            <option value="investinglive">InvestingLive</option>
                            <option value="ing">ING</option>
                            <option value="custom">Custom RSS Feeds</option>
                        </select>
                        <button id="refresh-news">Refresh News</button>
                    </div>
                </div>
                <div id="news-feed"></div>
                <div class="last-updated" id="last-updated">Last updated: <span id="update-time">Never</span></div>
            </div>
        </section>

        <section id="calendar" class="tab" style="display:none">
            <div class="card">
                <h2>Economic Calendar</h2>
                <div class="calendar-controls">
                    <h3>Upcoming Events (Next 30 Days)</h3>
                    <div class="calendar-filters">
                        <select id="importance-filter">
                            <option value="all">All Importance</option>
                            <option value="high">High Only</option>
                            <option value="medium">Medium Only</option>
                            <option value="low">Low Only</option>
                        </select>
                        <button id="refresh-calendar">Refresh</button>
                    </div>
                </div>
                <div id="calendar-events">
                    <div class="calendar-loading">Loading economic events...</div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Global variables for news data
        let newsData = {
            investinglive: [],
            ing: [],
            custom: {} // Object to store custom RSS feeds by name
        };
        
        let newsUpdateInterval;
        let customFeeds = {}; // Store custom RSS feed configurations

        function showTab(id, el){
            document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
            el.classList.add('active');
            
            // Load data when the tab is shown
            if (id === 'calendar') {
                loadEconomicCalendar();
            } else if (id === 'news') {
                // Refresh news when switching to news tab
                loadCustomFeedsFromStorage();
                refreshNews();
            } else if (id === 'analysis') {
                // Initialize market analysis
                updateMarketAnalysis();
            }
        }

        function showRssTab(tabId, button) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab and activate button
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
        }

        // ---------------------------- Market Analysis ----------------------------
        function updateMarketAnalysis() {
            // For demonstration, we'll use realistic but static values
            // In a real application, you would fetch these from a financial API
            
            document.getElementById('overall-sentiment').textContent = "62% Bullish";
            document.getElementById('overall-sentiment').className = "sentiment-value sentiment-bullish";
            
            document.getElementById('forex-sentiment').textContent = "58% Bullish";
            document.getElementById('forex-sentiment').className = "sentiment-value sentiment-neutral";
            
            document.getElementById('commodities-sentiment').textContent = "65% Bullish";
            document.getElementById('commodities-sentiment').className = "sentiment-value sentiment-bullish";
            
            document.getElementById('volatility').textContent = "Medium";
            document.getElementById('volatility').className = "sentiment-value sentiment-neutral";
            
            // Update the technical analysis widget symbol based on selection
            const symbol = document.getElementById('analysis-symbol').value;
            const timeframe = document.getElementById('analysis-timeframe').value;
            
            // This would ideally update the TradingView widgets, but they're loaded asynchronously
            // For a real implementation, you'd need to destroy and recreate the widgets
        }

        document.getElementById('refresh-analysis').addEventListener('click', updateMarketAnalysis);
        document.getElementById('analysis-symbol').addEventListener('change', updateMarketAnalysis);
        document.getElementById('analysis-timeframe').addEventListener('change', updateMarketAnalysis);

        // ---------------------------- RSS Feed Management ----------------------------
        document.getElementById('add-rss-feed').addEventListener('click', addCustomRSSFeed);
        document.getElementById('add-rss-file').addEventListener('click', addRSSFromFile);
        document.getElementById('refresh-news').addEventListener('click', refreshNews);
        document.getElementById('news-source-filter').addEventListener('change', filterNews);

        // Load custom feeds from localStorage on page load
        function loadCustomFeedsFromStorage() {
            const savedFeeds = localStorage.getItem('customRSSFeeds');
            if (savedFeeds) {
                customFeeds = JSON.parse(savedFeeds);
                updateCustomFeedsList();
            }
        }

        // Save custom feeds to localStorage
        function saveCustomFeedsToStorage() {
            localStorage.setItem('customRSSFeeds', JSON.stringify(customFeeds));
        }

        // Add a new custom RSS feed from URL
        function addCustomRSSFeed() {
            const urlInput = document.getElementById('rss-url');
            const nameInput = document.getElementById('rss-name');
            
            const url = urlInput.value.trim();
            let name = nameInput.value.trim();
            
            if (!url) {
                alert('Please enter an RSS feed URL');
                return;
            }
            
            // Validate URL format
            try {
                new URL(url);
            } catch (e) {
                alert('Please enter a valid URL');
                return;
            }
            
            // Generate a name if not provided
            if (!name) {
                // Try to extract name from URL
                try {
                    const domain = new URL(url).hostname;
                    name = domain.replace('www.', '').split('.')[0];
                    name = name.charAt(0).toUpperCase() + name.slice(1);
                } catch (e) {
                    name = `Custom Feed ${Object.keys(customFeeds).length + 1}`;
                }
            }
            
            // Check if name already exists
            if (customFeeds[name]) {
                alert('A feed with this name already exists');
                return;
            }
            
            // Add the feed
            customFeeds[name] = { type: 'url', url: url };
            saveCustomFeedsToStorage();
            updateCustomFeedsList();
            
            // Clear inputs
            urlInput.value = '';
            nameInput.value = '';
            
            // Refresh news to include the new feed
            refreshNews();
        }

        // Add RSS feed from uploaded XML file
        async function addRSSFromFile() {
            const fileInput = document.getElementById('rss-file');
            const nameInput = document.getElementById('rss-file-name');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Please select an XML file');
                return;
            }
            
            const file = fileInput.files[0];
            let name = nameInput.value.trim();
            
            // Validate file type
            if (!file.name.toLowerCase().endsWith('.xml') && !file.name.toLowerCase().endsWith('.rss')) {
                alert('Please select an XML or RSS file');
                return;
            }
            
            if (!name) {
                name = file.name.replace('.xml', '').replace('.rss', '').replace(/\.[^/.]+$/, "");
            }
            
            // Check if name already exists
            if (customFeeds[name]) {
                alert('A feed with this name already exists');
                return;
            }
            
            try {
                const text = await readFileAsText(file);
                const items = parseRSSFromText(text, name);
                
                // Add to custom feeds
                customFeeds[name] = { type: 'file', content: text };
                newsData.custom[name] = items;
                
                saveCustomFeedsToStorage();
                updateCustomFeedsList();
                
                // Clear inputs
                fileInput.value = '';
                nameInput.value = '';
                
                displayNews();
                
            } catch (error) {
                alert(`Error reading file: ${error.message}`);
            }
        }

        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(new Error('Failed to read file'));
                reader.readAsText(file);
            });
        }

        function parseRSSFromText(xmlText, source) {
            const parser = new DOMParser();
            const xml = parser.parseFromString(xmlText, "application/xml");
            
            // Check for XML parsing errors
            if (xml.querySelector('parsererror')) {
                throw new Error('Invalid XML format');
            }
            
            const items = xml.querySelectorAll("item");
            const newsItems = [];
            
            items.forEach(item => {
                const title = item.querySelector("title")?.textContent || 'No title';
                const link = item.querySelector("link")?.textContent || '#';
                const description = item.querySelector("description")?.textContent || '';
                const pubDate = item.querySelector("pubDate")?.textContent || 
                              item.querySelector("pubdate")?.textContent || 
                              new Date().toISOString();
                
                newsItems.push({
                    title,
                    link,
                    description: description.replace(/<[^>]*>/g, '').substring(0, 200) + '...',
                    pubDate: new Date(pubDate),
                    source: source
                });
            });
            
            return newsItems;
        }

        // Remove a custom RSS feed
        function removeCustomRSSFeed(name) {
            if (confirm(`Are you sure you want to remove "${name}"?`)) {
                delete customFeeds[name];
                delete newsData.custom[name];
                saveCustomFeedsToStorage();
                updateCustomFeedsList();
                displayNews(); // Refresh the display
            }
        }

        // Update the list of custom feeds in the UI
        function updateCustomFeedsList() {
            const feedsList = document.getElementById('rss-feeds-list');
            feedsList.innerHTML = '';
            
            if (Object.keys(customFeeds).length === 0) {
                feedsList.innerHTML = '<div class="small">No custom feeds added yet.</div>';
                return;
            }
            
            for (const [name, feed] of Object.entries(customFeeds)) {
                const feedItem = document.createElement('div');
                feedItem.className = 'rss-feed-item';
                feedItem.innerHTML = `
                    <div>
                        <span class="rss-feed-name">${name}</span>
                        <span class="rss-feed-type">(${feed.type === 'url' ? 'URL' : 'File'})</span>
                    </div>
                    <div class="rss-feed-actions">
                        <button onclick="testRSSFeed('${name}')">Test</button>
                        <button onclick="removeCustomRSSFeed('${name}')">Remove</button>
                    </div>
                `;
                feedsList.appendChild(feedItem);
            }
        }

        // Test an RSS feed
        async function testRSSFeed(name) {
            const feed = customFeeds[name];
            if (!feed) return;
            
            try {
                let items;
                if (feed.type === 'url') {
                    items = await fetchRSSFeed(feed.url, name);
                } else {
                    items = parseRSSFromText(feed.content, name);
                }
                
                if (items.length > 0) {
                    alert(`"${name}" is working! Found ${items.length} items.`);
                } else {
                    alert(`"${name}" returned no items. The feed might be empty or invalid.`);
                }
            } catch (error) {
                alert(`Error testing "${name}": ${error.message}`);
            }
        }

        // ---------------------------- News Functions ----------------------------
        async function refreshNews() {
            const newsContainer = document.getElementById('news-feed');
            newsContainer.innerHTML = '<div class="news-loading">Loading latest news...</div>';
            
            try {
                // Fetch from default sources
                const [investingliveData, ingData] = await Promise.allSettled([
                    fetchRSSFeed('https://www.investinglive.com/feed', 'investinglive'),
                    fetchRSSFeed('https://think.ing.com/rss', 'ing')
                ]);
                
                // Update news data
                if (investingliveData.status === 'fulfilled') {
                    newsData.investinglive = investingliveData.value;
                }
                
                if (ingData.status === 'fulfilled') {
                    newsData.ing = ingData.value;
                }
                
                // Fetch from custom RSS feeds
                for (const [name, feed] of Object.entries(customFeeds)) {
                    try {
                        if (feed.type === 'url') {
                            const customData = await fetchRSSFeed(feed.url, name);
                            newsData.custom[name] = customData;
                        } else {
                            // For file-based feeds, just parse the stored content
                            newsData.custom[name] = parseRSSFromText(feed.content, name);
                        }
                    } catch (error) {
                        console.error(`Error fetching custom feed "${name}":`, error);
                        // Keep existing data if available
                        if (!newsData.custom[name]) {
                            newsData.custom[name] = [];
                        }
                    }
                }
                
                // Update the display
                displayNews();
                
                // Update last updated time
                const now = new Date();
                document.getElementById('update-time').textContent = now.toLocaleTimeString();
                
            } catch (error) {
                console.error('Error refreshing news:', error);
                newsContainer.innerHTML = '<div class="news-error">Failed to load news. Please try again.</div>';
            }
        }

        async function fetchRSSFeed(url, source) {
            try {
                // Use a CORS proxy to avoid cross-origin issues
                const proxyUrl = 'https://api.allorigins.win/get?url=';
                const res = await fetch(proxyUrl + encodeURIComponent(url));
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                
                const data = await res.json();
                const parser = new DOMParser();
                const xml = parser.parseFromString(data.contents, "application/xml");
                
                // Check for XML parsing errors
                if (xml.querySelector('parsererror')) {
                    throw new Error('Invalid XML format');
                }
                
                const items = xml.querySelectorAll("item");
                
                const newsItems = [];
                items.forEach(item => {
                    const title = item.querySelector("title")?.textContent || 'No title';
                    const link = item.querySelector("link")?.textContent || '#';
                    const description = item.querySelector("description")?.textContent || '';
                    const pubDate = item.querySelector("pubDate")?.textContent || 
                                  item.querySelector("pubdate")?.textContent || 
                                  new Date().toISOString();
                    
                    newsItems.push({
                        title,
                        link,
                        description: description.replace(/<[^>]*>/g, '').substring(0, 200) + '...',
                        pubDate: new Date(pubDate),
                        source: source
                    });
                });
                
                return newsItems;
            } catch (err) {
                console.error(`Error fetching ${source} RSS:`, err);
                throw err;
            }
        }

        function displayNews() {
            const newsContainer = document.getElementById('news-feed');
            const sourceFilter = document.getElementById('news-source-filter').value;
            
            // Combine all news items
            let allNews = [...newsData.investinglive, ...newsData.ing];
            
            // Add custom RSS feed items
            for (const items of Object.values(newsData.custom)) {
                allNews = allNews.concat(items);
            }
            
            // Sort by date (newest first)
            allNews.sort((a, b) => b.pubDate - a.pubDate);
            
            // Apply source filter
            if (sourceFilter !== 'all') {
                if (sourceFilter === 'custom') {
                    // Show all custom feeds
                    allNews = allNews.filter(item => 
                        item.source !== 'investinglive' && item.source !== 'ing'
                    );
                } else {
                    allNews = allNews.filter(item => item.source === sourceFilter);
                }
            }
            
            if (allNews.length === 0) {
                newsContainer.innerHTML = '<div class="news-loading">No news articles found.</div>';
                return;
            }
            
            let newsHTML = '';
            
            allNews.forEach(item => {
                const timeAgo = getTimeAgo(item.pubDate);
                let sourceName = item.source;
                
                // Format source name for display
                if (sourceName === 'investinglive') sourceName = 'InvestingLive';
                else if (sourceName === 'ing') sourceName = 'ING';
                // Otherwise, use the custom feed name as is
                
                newsHTML += `
                    <div class="news-item" data-source="${item.source}">
                        <div class="news-item-header">
                            <span class="news-source">${sourceName}</span>
                            <span class="news-time">${timeAgo}</span>
                        </div>
                        <div class="news-title">${item.title}</div>
                        <div class="news-description">${item.description}</div>
                        <a href="${item.link}" target="_blank" class="news-link">Read full article â†’</a>
                    </div>
                `;
            });
            
            newsContainer.innerHTML = newsHTML;
        }

        function filterNews() {
            displayNews();
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
        }

        // Start auto-refresh when page loads
        function startNewsAutoRefresh() {
            // Refresh immediately
            refreshNews();
            
            // Set up interval for auto-refresh (every 1 minute)
            if (newsUpdateInterval) {
                clearInterval(newsUpdateInterval);
            }
            
            newsUpdateInterval = setInterval(() => {
                // Only refresh if news tab is active
                if (document.getElementById('news').style.display !== 'none') {
                    refreshNews();
                }
            }, 60000); // 60 seconds
        }

        // ---------------------------- Economic Calendar ----------------------------
        document.getElementById('refresh-calendar').addEventListener('click', loadEconomicCalendar);
        document.getElementById('importance-filter').addEventListener('change', filterCalendarEvents);

        async function loadEconomicCalendar() {
            const calendarContainer = document.getElementById('calendar-events');
            calendarContainer.innerHTML = '<div class="calendar-loading">Loading economic events...</div>';
            
            try {
                // Fetch data for the current month and next month to get more events
                const today = new Date();
                const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
                
                // Format dates for the API (YYYY-MM-DD)
                const formatDate = (date) => date.toISOString().split('T')[0];
                
                // Using a free economic calendar API with date range
                const response = await fetch(`https://api.allorigins.win/get?url=` + 
                    encodeURIComponent(`https://economic-calendar.tradingview.com/events?from=${formatDate(today)}&to=${formatDate(nextMonth)}`));
                
                if (!response.ok) {
                    throw new Error('Failed to fetch calendar data');
                }
                
                const data = await response.json();
                let events;
                
                try {
                    events = JSON.parse(data.contents);
                } catch (e) {
                    // If the first API fails, try a fallback
                    console.log('First API failed, trying fallback...');
                    const fallbackResponse = await fetch('https://api.allorigins.win/get?url=' + 
                        encodeURIComponent('https://nfs.faireconomy.media/ff_calendar_thisweek.json'));
                    
                    if (!fallbackResponse.ok) {
                        throw new Error('Failed to fetch calendar data from fallback');
                    }
                    
                    const fallbackData = await fallbackResponse.json();
                    events = JSON.parse(fallbackData.contents);
                }
                
                // Filter events to show only upcoming ones
                const now = new Date();
                const upcomingEvents = events.filter(event => {
                    const eventDate = new Date(event.date || event.time);
                    return eventDate >= now;
                });
                
                displayCalendarEvents(upcomingEvents);
            } catch (error) {
                console.error('Error loading economic calendar:', error);
                // Show sample data if API fails
                displaySampleCalendarEvents();
            }
        }

        function displayCalendarEvents(events) {
            const calendarContainer = document.getElementById('calendar-events');
            
            if (!events || events.length === 0) {
                calendarContainer.innerHTML = '<div class="calendar-loading">No upcoming economic events found.</div>';
                return;
            }
            
            // Sort events by date
            events.sort((a, b) => new Date(a.date || a.time) - new Date(b.date || b.time));
            
            let eventsHTML = '';
            let currentDate = '';
            
            events.forEach(event => {
                const eventDateObj = new Date(event.date || event.time);
                const dateString = eventDateObj.toLocaleDateString([], { weekday: 'short', month: 'short', day: 'numeric' });
                const timeString = eventDateObj.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                // Add date header if date changed
                if (dateString !== currentDate) {
                    currentDate = dateString;
                    eventsHTML += `<div class="calendar-date-header">${dateString}</div>`;
                }
                
                // Determine importance level
                let importanceClass = 'importance-low';
                let importanceText = 'Low';
                
                if (event.impact === 'High' || event.importance === 3) {
                    importanceClass = 'importance-high';
                    importanceText = 'High';
                } else if (event.impact === 'Medium' || event.importance === 2) {
                    importanceClass = 'importance-medium';
                    importanceText = 'Medium';
                }
                
                eventsHTML += `
                    <div class="calendar-event" data-importance="${importanceText.toLowerCase()}">
                        <div class="event-date">${dateString}</div>
                        <div class="event-time">${timeString}</div>
                        <div class="event-details">
                            <div class="event-title">${event.title || event.event || event.name || 'Unknown Event'}</div>
                            <div class="event-country">${event.country || event.currency || 'Global'}</div>
                        </div>
                        <div class="event-importance">
                            <span class="${importanceClass}">${importanceText}</span>
                        </div>
                    </div>
                `;
            });
            
            calendarContainer.innerHTML = eventsHTML;
            filterCalendarEvents(); // Apply current filter
        }

        // Sample data in case API fails
        function displaySampleCalendarEvents() {
            const sampleEvents = [
                {
                    date: new Date(Date.now() + 86400000).toISOString(), // Tomorrow
                    time: new Date(Date.now() + 86400000).toISOString(),
                    title: "US Consumer Price Index (CPI)",
                    country: "USA",
                    impact: "High"
                },
                {
                    date: new Date(Date.now() + 2*86400000).toISOString(), // Day after tomorrow
                    time: new Date(Date.now() + 2*86400000).toISOString(),
                    title: "Federal Reserve Interest Rate Decision",
                    country: "USA",
                    impact: "High"
                },
                {
                    date: new Date(Date.now() + 3*86400000).toISOString(),
                    time: new Date(Date.now() + 3*86400000).toISOString(),
                    title: "European Central Bank Press Conference",
                    country: "EU",
                    impact: "High"
                },
                {
                    date: new Date(Date.now() + 5*86400000).toISOString(),
                    time: new Date(Date.now() + 5*86400000).toISOString(),
                    title: "UK Retail Sales",
                    country: "UK",
                    impact: "Medium"
                },
                {
                    date: new Date(Date.now() + 7*86400000).toISOString(),
                    time: new Date(Date.now() + 7*86400000).toISOString(),
                    title: "Japan Inflation Rate",
                    country: "Japan",
                    impact: "Medium"
                },
                {
                    date: new Date(Date.now() + 10*86400000).toISOString(),
                    time: new Date(Date.now() + 10*86400000).toISOString(),
                    title: "Canada Employment Change",
                    country: "Canada",
                    impact: "Medium"
                },
                {
                    date: new Date(Date.now() + 14*86400000).toISOString(),
                    time: new Date(Date.now() + 14*86400000).toISOString(),
                    title: "Australia Consumer Confidence",
                    country: "Australia",
                    impact: "Low"
                },
                {
                    date: new Date(Date.now() + 21*86400000).toISOString(),
                    time: new Date(Date.now() + 21*86400000).toISOString(),
                    title: "US GDP Growth Rate",
                    country: "USA",
                    impact: "High"
                },
                {
                    date: new Date(Date.now() + 28*86400000).toISOString(),
                    time: new Date(Date.now() + 28*86400000).toISOString(),
                    title: "Eurozone Inflation Rate",
                    country: "EU",
                    impact: "Medium"
                }
            ];
            
            displayCalendarEvents(sampleEvents);
        }

        function filterCalendarEvents() {
            const filterValue = document.getElementById('importance-filter').value;
            const events = document.querySelectorAll('.calendar-event');
            
            events.forEach(event => {
                if (filterValue === 'all' || event.getAttribute('data-importance') === filterValue) {
                    event.style.display = 'grid';
                } else {
                    event.style.display = 'none';
                }
            });
            
            // Also hide date headers if all events for that date are filtered out
            const dateHeaders = document.querySelectorAll('.calendar-date-header');
            dateHeaders.forEach(header => {
                const nextElements = [];
                let nextElement = header.nextElementSibling;
                
                while (nextElement && !nextElement.classList.contains('.calendar-date-header')) {
                    if (nextElement.classList.contains('calendar-event')) {
                        nextElements.push(nextElement);
                    }
                    nextElement = nextElement.nextElementSibling;
                }
                
                const visibleEvents = nextElements.filter(el => el.style.display !== 'none');
                header.style.display = visibleEvents.length > 0 ? 'block' : 'none';
            });
        }

        // ---------------------------- Trade Journal Functions ----------------------------
        document.getElementById('btn-import').addEventListener('click', ()=>{
            const fi = document.getElementById('file-input');
            if(!fi.files || fi.files.length===0){ alert('Choose a file first'); return; }
            const file = fi.files[0];
            const reader = new FileReader();
            reader.onload = e => {
                const text = e.target.result;
                alert('File imported successfully! (Trade analysis would be implemented here)');
            };
            reader.readAsText(file);
        });

        document.getElementById('btn-parse').addEventListener('click', ()=>{
            const txt = document.getElementById('paste-area').value;
            if(!txt) return alert('Paste CSV or table text first');
            alert('Data parsed successfully! (Trade analysis would be implemented here)');
        });

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Load custom feeds when page loads
            loadCustomFeedsFromStorage();
            
            // Start news auto-refresh if news tab is active or if it's the default tab
            if (window.location.hash === '#news' || document.querySelector('.tab[style*="block"]').id === 'news') {
                startNewsAutoRefresh();
            }
            
            // Start news auto-refresh when switching to news tab
            document.querySelector('a[href="#news"]').addEventListener('click', function() {
                startNewsAutoRefresh();
            });
            
            // Initialize market analysis
            updateMarketAnalysis();
        });
    </script>
</body>
</html>